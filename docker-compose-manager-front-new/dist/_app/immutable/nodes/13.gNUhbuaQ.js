import{f as d,a as r,t as V,c as he}from"../chunks/AQshOrwM.js";import{o as ot}from"../chunks/DArI6N9H.js";import{p as at,b as U,k as st,u as nt,g as e,e as ee,d as p,t as I,a as it,s as n,c as o,f as x,r as a,n as f}from"../chunks/BGIsFGxD.js";import{s as W}from"../chunks/CK6JJk40.js";import{r as be,c as De,e as ye,i as xe}from"../chunks/BIIYjbM9.js";import{a as lt,i as z,b as Oe}from"../chunks/BBZnTf8d.js";import{a as Qe,c as ct}from"../chunks/jbU8H10p.js";import{b as dt}from"../chunks/DGg9txeK.js";import{p as vt}from"../chunks/DSIao-Rg.js";import{H as ut,L as pt,a as ce,P as gt,S as ft}from"../chunks/B8pBSBZ4.js";import{t as mt}from"../chunks/DNE0aubT.js";import{c as _t}from"../chunks/BVN2tSMg.js";import{c as $t}from"../chunks/C1OtUQtP.js";import{B as ne}from"../chunks/BZEFvVZa.js";import{I as Ke}from"../chunks/FLXc8Hxn.js";import{L as ie}from"../chunks/BG8J9VMA.js";import{C as Ne,a as Ee,b as Me}from"../chunks/D2rqKE8K.js";import{C as Ve}from"../chunks/cuYGTcpL.js";import"../chunks/Dkv5VvjD.js";import"../chunks/B9IV9xzZ.js";import"../chunks/B4PLRw1v.js";import"../chunks/Bmet6DEc.js";import"../chunks/CVCFcqur.js";import"../chunks/DXzkz7Sz.js";import{c as We}from"../chunks/Dw9yDBlQ.js";import{T as ht}from"../chunks/BJjaivRV.js";import{F as bt}from"../chunks/DMtmJ6bz.js";import{t as le}from"../chunks/CUtoxrzn.js";let s=null;const yt=()=>"";function xt(i={}){const $=yt(),w=$?`${$}/hubs/logs`:"/hubs/logs";return s=new ut().withUrl(w,{accessTokenFactory:()=>localStorage.getItem("accessToken")||""}).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).configureLogging(pt.Warning).build(),i.onLogReceived&&s.on("LogReceived",i.onLogReceived),s.onclose(q=>{i.onDisconnected?.(q??void 0)}),s.onreconnecting(q=>{i.onReconnecting?.(q??void 0)}),s.onreconnected(()=>{i.onConnected?.()}),s}async function ze(){if(s)try{await s.start(),console.log("Logs Hub connected")}catch(i){console.error("Logs Hub connection error:",i),setTimeout(ze,5e3)}}async function wt(){if(s)try{await s.stop(),console.log("Logs Hub disconnected")}catch(i){console.error("Logs Hub disconnection error:",i)}}async function Lt(i,$=100){if(!s||s.state!==ce.Connected){console.warn("Logs Hub not connected");return}try{await s.invoke("StartContainerLogs",i,$)}catch(w){console.error("Failed to start container logs:",w)}}async function Pt(i){if(!(!s||s.state!==ce.Connected))try{await s.invoke("StopContainerLogs",i)}catch($){console.error("Failed to stop container logs:",$)}}async function St(i,$,w=100){if(!s||s.state!==ce.Connected){console.warn("Logs Hub not connected");return}try{await s.invoke("StartProjectLogs",i,$,w)}catch(q){console.error("Failed to start project logs:",q)}}async function Ct(i){if(!(!s||s.state!==ce.Connected))try{await s.invoke("StopProjectLogs",i)}catch($){console.error("Failed to stop project logs:",$)}}var kt=d("<option> </option>"),jt=d('<div class="space-y-2"><!> <select id="container" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2.5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"><option>-- Select a container --</option><!></select></div>'),Ht=d("<option> </option>"),Tt=d('<div class="grid grid-cols-2 gap-4"><div class="space-y-2"><!> <select id="project" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2.5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"><option>-- Select a project --</option><!></select></div> <div class="space-y-2"><!> <!></div></div>'),Rt=d("<!> Start Streaming",1),Ft=d("<!> Stop Streaming",1),Ut=d("<!> Clear",1),It=d("<!> Download",1),qt=d('<div class="flex gap-4"><label class="flex items-center gap-2 cursor-pointer"><input type="radio" class="h-4 w-4"/> <span class="font-medium text-gray-900 dark:text-white">Container</span></label> <label class="flex items-center gap-2 cursor-pointer"><input type="radio" class="h-4 w-4"/> <span class="font-medium text-gray-900 dark:text-white">Compose Project</span></label></div> <!> <div class="space-y-2"><!> <!></div> <div class="flex gap-2 flex-wrap"><!> <!> <!> <label class="flex items-center gap-2 ml-auto cursor-pointer"><input type="checkbox" class="h-4 w-4"/> <span class="text-sm font-medium text-gray-900 dark:text-white">Auto-scroll</span></label></div>',1),At=d("<!> <!>",1),Bt=d('<div class="flex items-center gap-2"><div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div> <span class="text-sm text-green-600 dark:text-green-400">Streaming...</span></div>'),Dt=d('<div class="flex items-center justify-between"><!> <!></div>'),Ot=d('<p class="text-gray-500">No logs yet. Start streaming to see logs.</p>'),Qt=d('<div class="hover:bg-gray-800 px-2 py-1 rounded"><span class="text-gray-400"> </span> <span class="ml-2"> </span></div>'),Kt=d('<div class="bg-gray-900 dark:bg-black rounded-lg p-4 font-mono text-sm text-gray-100 max-h-[600px] overflow-auto"><!></div>'),Nt=d("<!> <!>",1),Et=d('<div class="space-y-6"><div><h1 class="text-3xl font-bold text-gray-900 dark:text-white"> </h1> <p class="text-gray-600 dark:text-gray-400 mt-1">Stream real-time logs from containers and compose projects</p></div> <!> <!></div>');function hr(i,$){at($,!0);const w=()=>Oe(vt,"$page",we),q=()=>Oe(mt,"$t",we),[we,Ge]=lt(),Le=[];let L=U(st([])),h=U(!1),G,de=U(!0);const Pe=ee(()=>w().url.searchParams.get("containerId")),Se=ee(()=>w().url.searchParams.get("projectPath")),Ce=ee(()=>w().url.searchParams.get("service"));let H=U("project"),T=U(""),A=U(""),te=U(""),re=U(100);nt(()=>{e(Pe)&&(p(H,"container"),p(T,e(Pe),!0)),e(Se)&&p(A,e(Se),!0),e(Ce)&&p(te,e(Ce),!0)});const ke=We(()=>({queryKey:["containers"],queryFn:()=>_t.list()})),je=We(()=>({queryKey:["compose","projects"],queryFn:()=>$t.listProjects()}));ot(()=>(xt({onLogReceived:J=>{p(L,[...e(L),J],!0),e(de)&&G&&setTimeout(()=>{G.scrollTop=G.scrollHeight},50)},onConnected:()=>{console.log("Logs hub connected")},onDisconnected:()=>{p(h,!1)}})&&ze(),e(T)&&setTimeout(()=>He(),1e3),()=>{e(h)&&Te(),wt()}));async function He(){if(e(H)==="container"){if(!e(T)){le.error("Please select a container");return}await Lt(e(T),e(re))}else{if(!e(A)){le.error("Please select a project");return}await St(e(A),e(te)||void 0,e(re))}p(h,!0),le.success("Log streaming started")}async function Te(){e(H)==="container"&&e(T)?await Pt(e(T)):e(A)&&await Ct(e(A)),p(h,!1),le.success("Log streaming stopped")}function Je(){p(L,[],!0)}function Xe(){const R=e(L).map(K=>`${K.timestamp} ${K.message}`).join(`
`),J=new Blob([R],{type:"text/plain"}),F=URL.createObjectURL(J),P=document.createElement("a");P.href=F,P.download=`logs-${new Date().toISOString().replace(/:/g,"-")}.txt`,P.click(),URL.revokeObjectURL(F)}var ve=Et(),ue=o(ve),Re=o(ue),Ye=o(Re,!0);a(Re),f(2),a(ue);var Fe=n(ue,2);Ne(Fe,{children:(R,J)=>{var F=At(),P=x(F);Ee(P,{children:(B,pe)=>{Me(B,{children:(m,S)=>{f();var C=V("Log Source");r(m,C)},$$slots:{default:!0}})},$$slots:{default:!0}});var K=n(P,2);Ve(K,{class:"space-y-4",children:(B,pe)=>{var m=qt(),S=x(m),C=o(S),k=o(C);be(k),k.value=k.__value="container",f(2),a(C);var c=n(C,2),_=o(c);be(_),_.value=_.__value="project",f(2),a(c),a(S);var D=n(S,2);{var ge=t=>{var v=jt(),b=o(v);ie(b,{for:"container",children:(j,E)=>{f();var M=V("Select Container");r(j,M)},$$slots:{default:!0}});var l=n(b,2),u=o(l);u.value=u.__value="";var Y=n(u);{var me=j=>{var E=he(),M=x(E);ye(M,17,()=>ke.data,xe,(_e,g)=>{var y=kt(),Q=o(y,!0);a(y);var se={};I(()=>{W(Q,e(g).name),se!==(se=e(g).id)&&(y.value=(y.__value=e(g).id)??"")}),r(_e,y)}),r(j,E)};z(Y,j=>{ke.data&&j(me)})}a(l),a(v),I(()=>l.disabled=e(h)),De(l,()=>e(T),j=>p(T,j)),r(t,v)},oe=t=>{var v=Tt(),b=o(v),l=o(b);ie(l,{for:"project",children:(g,y)=>{f();var Q=V("Select Project");r(g,Q)},$$slots:{default:!0}});var u=n(l,2),Y=o(u);Y.value=Y.__value="";var me=n(Y);{var j=g=>{var y=he(),Q=x(y);ye(Q,17,()=>je.data,xe,(se,$e)=>{var Z=Ht(),rt=o(Z,!0);a(Z);var Be={};I(()=>{W(rt,e($e).name),Be!==(Be=e($e).name)&&(Z.value=(Z.__value=e($e).name)??"")}),r(se,Z)}),r(g,y)};z(me,g=>{je.data&&g(j)})}a(u),a(b);var E=n(b,2),M=o(E);ie(M,{for:"service",children:(g,y)=>{f();var Q=V("Service (optional)");r(g,Q)},$$slots:{default:!0}});var _e=n(M,2);Ke(_e,{id:"service",type:"text",get disabled(){return e(h)},placeholder:"Leave empty for all services",get value(){return e(te)},set value(g){p(te,g,!0)}}),a(E),a(v),I(()=>u.disabled=e(h)),De(u,()=>e(A),g=>p(A,g)),r(t,v)};z(D,t=>{e(H)==="container"?t(ge):t(oe,!1)})}var O=n(D,2),N=o(O);ie(N,{for:"tail",children:(t,v)=>{f();var b=V("Tail Lines");r(t,b)},$$slots:{default:!0}});var fe=n(N,2);Ke(fe,{id:"tail",type:"number",get disabled(){return e(h)},min:"1",max:"1000",placeholder:"100",get value(){return e(re)},set value(t){p(re,t,!0)}}),a(O);var X=n(O,2),ae=o(X);{var et=t=>{ne(t,{onclick:He,children:(v,b)=>{var l=Rt(),u=x(l);gt(u,{class:"w-4 h-4 mr-2"}),f(),r(v,l)},$$slots:{default:!0}})},tt=t=>{ne(t,{variant:"destructive",onclick:Te,children:(v,b)=>{var l=Ft(),u=x(l);ft(u,{class:"w-4 h-4 mr-2"}),f(),r(v,l)},$$slots:{default:!0}})};z(ae,t=>{e(h)?t(tt,!1):t(et)})}var Ue=n(ae,2);{let t=ee(()=>e(L).length===0);ne(Ue,{variant:"outline",onclick:Je,get disabled(){return e(t)},children:(v,b)=>{var l=Ut(),u=x(l);ht(u,{class:"w-4 h-4 mr-2"}),f(),r(v,l)},$$slots:{default:!0}})}var Ie=n(Ue,2);{let t=ee(()=>e(L).length===0);ne(Ie,{variant:"outline",onclick:Xe,get disabled(){return e(t)},children:(v,b)=>{var l=It(),u=x(l);bt(u,{class:"w-4 h-4 mr-2"}),f(),r(v,l)},$$slots:{default:!0}})}var qe=n(Ie,2),Ae=o(qe);be(Ae),f(2),a(qe),a(X),I(()=>{k.disabled=e(h),_.disabled=e(h)}),Qe(Le,[],k,()=>e(H),t=>p(H,t)),Qe(Le,[],_,()=>e(H),t=>p(H,t)),ct(Ae,()=>e(de),t=>p(de,t)),r(B,m)},$$slots:{default:!0}}),r(R,F)},$$slots:{default:!0}});var Ze=n(Fe,2);Ne(Ze,{children:(R,J)=>{var F=Nt(),P=x(F);Ee(P,{children:(B,pe)=>{var m=Dt(),S=o(m);Me(S,{children:(c,_)=>{f();var D=V();I(()=>W(D,`Logs (${e(L).length??""} lines)`)),r(c,D)},$$slots:{default:!0}});var C=n(S,2);{var k=c=>{var _=Bt();r(c,_)};z(C,c=>{e(h)&&c(k)})}a(m),r(B,m)},$$slots:{default:!0}});var K=n(P,2);Ve(K,{children:(B,pe)=>{var m=Kt(),S=o(m);{var C=c=>{var _=Ot();r(c,_)},k=c=>{var _=he(),D=x(_);ye(D,17,()=>e(L),xe,(ge,oe)=>{var O=Qt(),N=o(O),fe=o(N,!0);a(N);var X=n(N,2),ae=o(X,!0);a(X),a(O),I(()=>{W(fe,e(oe).timestamp),W(ae,e(oe).message)}),r(ge,O)}),r(c,_)};z(S,c=>{e(L).length===0?c(C):c(k,!1)})}a(m),dt(m,c=>G=c,()=>G),r(B,m)},$$slots:{default:!0}}),r(R,F)},$$slots:{default:!0}}),a(ve),I(R=>W(Ye,R),[()=>q()("common.logs")||"Logs Viewer"]),r(i,ve),it(),Ge()}export{hr as component};
