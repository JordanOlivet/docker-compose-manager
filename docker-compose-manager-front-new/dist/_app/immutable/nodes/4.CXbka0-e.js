import{c as N,a as l,f as $,t as tt}from"../chunks/AQshOrwM.js";import{f as T,p as ne,a as le,c as e,s,r as t,k as Bt,b as U,t as m,g as o,d as b,n as pt,e as gt}from"../chunks/BGIsFGxD.js";import{s as d}from"../chunks/CK6JJk40.js";import{a as Xe,c as Ye,e as Et,i as se}from"../chunks/BIIYjbM9.js";import{l as ue,s as ve,p as Ze,i as O,r as ta,a as ea,b as aa}from"../chunks/BBZnTf8d.js";import{I as ce,s as pe,a as J,t as ra}from"../chunks/DNE0aubT.js";import{L as oa}from"../chunks/BUAbUYdX.js";import{C as sa}from"../chunks/B4PLRw1v.js";import{I as ie}from"../chunks/FLXc8Hxn.js";import{s as ia}from"../chunks/4pOCAdSq.js";import{c as da}from"../chunks/CXvqTlXp.js";import"../chunks/CVCFcqur.js";import{B as et}from"../chunks/BZEFvVZa.js";import{u as na}from"../chunks/ygxaYeff.js";import{c as Kt}from"../chunks/Dw9yDBlQ.js";import{c as la}from"../chunks/Bri70JPp.js";import{S as ua}from"../chunks/iUuFbj3C.js";import{t as de}from"../chunks/CUtoxrzn.js";import{R as va}from"../chunks/BLWlkucS.js";import{T as ca}from"../chunks/BJjaivRV.js";import{C as pa}from"../chunks/awGEBtpY.js";function ga(g,u){const r=ue(u,["children","$$slots","$$events","$$legacy"]);const j=[["path",{d:"m6 9 6 6 6-6"}]];ce(g,ve({name:"chevron-down"},()=>r,{get iconNode(){return j},children:(q,P)=>{var f=N(),H=T(f);pe(H,u,"default",{}),l(q,f)},$$slots:{default:!0}}))}function _a(g,u){const r=ue(u,["children","$$slots","$$events","$$legacy"]);const j=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z"}]];ce(g,ve({name:"funnel"},()=>r,{get iconNode(){return j},children:(q,P)=>{var f=N(),H=T(f);pe(H,u,"default",{}),l(q,f)},$$slots:{default:!0}}))}const _t={listAuditLogs:async g=>{const u=await J.get("/audit",{params:g});if(!u.data.data)throw new Error("Failed to fetch audit logs");return u.data.data},getAuditLog:async g=>{const u=await J.get(`/audit/${g}`);if(!u.data.data)throw new Error("Audit log not found");return u.data.data},getDistinctActions:async()=>(await J.get("/audit/actions")).data.data||[],getDistinctResourceTypes:async()=>(await J.get("/audit/resource-types")).data.data||[],getUserAuditActivity:async(g,u=100)=>{const r=await J.get(`/audit/users/${g}`,{params:{limit:u}});if(!r.data.data)throw new Error("Failed to fetch user audit activity");return r.data.data},getAuditStats:async()=>{const g=await J.get("/audit/stats");if(!g.data.data)throw new Error("Failed to fetch audit stats");return g.data.data},purgeOldLogs:async g=>{const u=new Date;u.setDate(u.getDate()-g.olderThanDays);const r=await J.delete("/audit/purge",{params:{beforeDate:u.toISOString(),dryRun:g.dryRun||!1}});if(!r.data.data)throw new Error("Failed to purge logs");return r.data.data}},C={Timestamp:"Timestamp",Action:"Action",UserId:"UserId",ResourceType:"ResourceType"},at={Ascending:"Ascending",Descending:"Descending"};var ma=$('<div class="relative"><select><!></select> <!></div>');function mt(g,u){ne(u,!0);let r=Ze(u,"value",15),j=ta(u,["$$slots","$$events","$$legacy","children","class","value"]);var q=ma(),P=e(q);Xe(P,I=>({class:I,...j}),[()=>da("flex h-10 w-full items-center justify-between rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm text-gray-900 dark:text-gray-100 ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 appearance-none",u.class)]);var f=e(P);{var H=I=>{var G=N(),V=T(G);ia(V,()=>u.children),l(I,G)};O(f,I=>{u.children&&I(H)})}t(P);var S=s(P,2);ga(S,{class:"absolute right-3 top-3 h-4 w-4 opacity-50 pointer-events-none"}),t(q),Ye(P,r),l(g,q),le()}var fa=$('<div class="mt-4 space-y-2"><label for="purge-days" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Delete logs older than (days):</label> <!></div>'),ya=$("<!> ",1),xa=$("<!> ",1),ha=$("<option> </option>"),ba=$("<option> </option> <!>",1),$a=$("<option> </option>"),wa=$("<option> </option> <!>",1),ka=$("<option> </option> <option> </option> <option> </option> <option> </option>",1),Ta=$("<option> </option> <option> </option>",1),Aa=$('<div class="mb-4"><p class="text-sm text-gray-600 dark:text-gray-400"> </p></div>'),Da=$('<div class="text-center py-8 text-red-500"> </div>'),Pa=$('<div class="text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow"><!> <p class="text-gray-600 dark:text-gray-400"> </p></div>'),Fa=$('<span class="text-gray-400 dark:text-gray-500">-</span>'),La=$('<tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50"><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400"> </td><td class="px-6 py-4 whitespace-nowrap"><span class="font-medium text-gray-900 dark:text-white"> </span></td><td class="px-6 py-4 whitespace-nowrap"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300"> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400"><!></td><td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600 dark:text-gray-400"> </td></tr>'),Ra=$('<div class="px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-800/50"><div class="flex items-center justify-between"><div class="text-sm text-gray-600 dark:text-gray-400"> </div> <div class="flex gap-2"><!> <!></div></div></div>'),Sa=$('<div class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-lg"><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"><thead class="bg-gray-50 dark:bg-gray-900"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"> </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"> </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"> </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"> </th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"> </th></tr></thead><tbody class="divide-y divide-gray-200 dark:divide-gray-700"></tbody></table></div> <!></div>'),Ia=$('<!> <div class="space-y-6"><div class="flex justify-between items-start"><div><h1 class="text-3xl font-bold text-gray-900 dark:text-white"> </h1> <p class="text-gray-600 dark:text-gray-400 mt-1"> </p></div> <div class="flex gap-2"><!> <!></div></div>   <div class="p-6 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 shadow-lg"><div class="flex items-center gap-2 mb-4"><div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg"><!></div> <h3 class="text-sm font-semibold text-gray-900 dark:text-white"> </h3></div> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"><div><label for="actionFilter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> </label> <!></div> <div><label for="resourceTypeFilter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> </label> <!></div> <div><label for="sortBy" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> </label> <!></div> <div><label for="sortOrder" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> </label> <!></div></div> <div class="flex gap-2 mt-4"><!> <!></div></div> <div class="flex gap-4"><div class="relative flex-1"><!> <!></div></div> <!> <!></div>',1);function er(g,u){ne(u,!0);const r=()=>aa(ra,"$t",j),[j,q]=ea();let P=U(""),f=U(1);const H=50;let S=Bt({open:!1,days:30}),I=U(""),G=U(""),V=U(""),vt=U(""),rt=U(Bt(C.Timestamp)),ot=U(Bt(at.Descending));const Mt=na(),L=Kt(()=>({queryKey:["audit",o(f),o(P),o(V),o(vt),o(rt),o(ot)],queryFn:()=>_t.listAuditLogs({page:o(f),pageSize:H,search:o(P)||void 0,action:o(V)||void 0,resourceType:o(vt)||void 0,sortBy:o(rt),sortOrder:o(ot)})})),ft=Kt(()=>({queryKey:["audit","distinctActions"],queryFn:()=>_t.getDistinctActions()})),yt=Kt(()=>({queryKey:["audit","distinctResourceTypes"],queryFn:()=>_t.getDistinctResourceTypes()})),ge=la(()=>({mutationFn:a=>_t.purgeOldLogs({olderThanDays:a}),onSuccess:a=>{Mt.invalidateQueries({queryKey:["audit"]}),de.success(`Purged ${a.deletedCount} old audit logs`),S.open=!1},onError:()=>de.error("Failed to purge logs")}));function _e(){S.open=!0}function me(a){return new Date(a).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function fe(){b(V,o(I),!0),b(vt,o(G),!0),b(f,1)}function ye(){b(I,""),b(G,""),b(V,""),b(vt,""),b(P,""),b(rt,C.Timestamp,!0),b(ot,at.Descending,!0),b(f,1)}function xe(){Mt.invalidateQueries({queryKey:["audit"]})}var Ut=Ia(),Nt=T(Ut);sa(Nt,{get open(){return S.open},title:"Purge Old Audit Logs",get description(){return`This will permanently delete audit logs older than ${S.days??""} days. This action cannot be undone.`},onconfirm:()=>ge.mutate(S.days),oncancel:()=>S.open=!1,children:(a,_)=>{var n=fa(),i=s(e(n),2);ie(i,{id:"purge-days",type:"number",min:"1",max:"365",class:"w-full",get value(){return S.days},set value(y){S.days=y}}),t(n),l(a,n)},$$slots:{default:!0}});var jt=s(Nt,2),xt=e(jt),ht=e(xt),bt=e(ht),he=e(bt,!0);t(bt);var Ht=s(bt,2),be=e(Ht,!0);t(Ht),t(ht);var Gt=s(ht,2),Jt=e(Gt);et(Jt,{variant:"outline",onclick:xe,children:(a,_)=>{var n=ya(),i=T(n);va(i,{class:"w-4 h-4 mr-2"});var y=s(i);m(p=>d(y,` ${p??""}`),[()=>r()("common.refresh")]),l(a,n)},$$slots:{default:!0}});var $e=s(Jt,2);et($e,{variant:"destructive",onclick:_e,children:(a,_)=>{var n=xa(),i=T(n);ca(i,{class:"w-4 h-4 mr-2"});var y=s(i);m(p=>d(y,` ${p??""}`),[()=>r()("audit.purgeLogs")]),l(a,n)},$$slots:{default:!0}}),t(Gt),t(xt);var $t=s(xt,2),wt=e($t),kt=e(wt),we=e(kt);_a(we,{class:"w-4 h-4 text-blue-600 dark:text-blue-400"}),t(kt);var Vt=s(kt,2),ke=e(Vt,!0);t(Vt),t(wt);var Tt=s(wt,2),At=e(Tt),Dt=e(At),Te=e(Dt,!0);t(Dt);var Ae=s(Dt,2);mt(Ae,{get disabled(){return ft.isLoading},get value(){return o(I)},set value(a){b(I,a,!0)},children:(a,_)=>{var n=ba(),i=T(n),y=e(i,!0);t(i),i.value=i.__value="";var p=s(i,2);{var v=x=>{var k=N(),F=T(k);Et(F,17,()=>ft.data,se,(A,h)=>{var c=ha(),R=e(c,!0);t(c);var D={};m(()=>{d(R,o(h)),D!==(D=o(h))&&(c.value=(c.__value=o(h))??"")}),l(A,c)}),l(x,k)};O(p,x=>{ft.data&&x(v)})}m(x=>d(y,x),[()=>r()("common.all")]),l(a,n)},$$slots:{default:!0}}),t(At);var Pt=s(At,2),Ft=e(Pt),De=e(Ft,!0);t(Ft);var Pe=s(Ft,2);mt(Pe,{get disabled(){return yt.isLoading},get value(){return o(G)},set value(a){b(G,a,!0)},children:(a,_)=>{var n=wa(),i=T(n),y=e(i,!0);t(i),i.value=i.__value="";var p=s(i,2);{var v=x=>{var k=N(),F=T(k);Et(F,17,()=>yt.data,se,(A,h)=>{var c=$a(),R=e(c,!0);t(c);var D={};m(()=>{d(R,o(h)),D!==(D=o(h))&&(c.value=(c.__value=o(h))??"")}),l(A,c)}),l(x,k)};O(p,x=>{yt.data&&x(v)})}m(x=>d(y,x),[()=>r()("common.all")]),l(a,n)},$$slots:{default:!0}}),t(Pt);var Lt=s(Pt,2),Rt=e(Lt),Fe=e(Rt,!0);t(Rt);var Le=s(Rt,2);mt(Le,{get value(){return o(rt)},set value(a){b(rt,a,!0)},children:(a,_)=>{var n=ka(),i=T(n),y=e(i,!0);t(i);var p={},v=s(i,2),x=e(v,!0);t(v);var k={},F=s(v,2),A=e(F,!0);t(F);var h={},c=s(F,2),R=e(c,!0);t(c);var D={};m((W,st,Ct,it)=>{d(y,W),p!==(p=C.Timestamp)&&(i.value=(i.__value=C.Timestamp)??""),d(x,st),k!==(k=C.Action)&&(v.value=(v.__value=C.Action)??""),d(A,Ct),h!==(h=C.UserId)&&(F.value=(F.__value=C.UserId)??""),d(R,it),D!==(D=C.ResourceType)&&(c.value=(c.__value=C.ResourceType)??"")},[()=>r()("audit.timestamp"),()=>r()("audit.action"),()=>r()("audit.user"),()=>r()("audit.resourceType")]),l(a,n)},$$slots:{default:!0}}),t(Lt);var Wt=s(Lt,2),St=e(Wt),Re=e(St,!0);t(St);var Se=s(St,2);mt(Se,{get value(){return o(ot)},set value(a){b(ot,a,!0)},children:(a,_)=>{var n=Ta(),i=T(n),y=e(i,!0);t(i);var p={},v=s(i,2),x=e(v,!0);t(v);var k={};m((F,A)=>{d(y,F),p!==(p=at.Descending)&&(i.value=(i.__value=at.Descending)??""),d(x,A),k!==(k=at.Ascending)&&(v.value=(v.__value=at.Ascending)??"")},[()=>r()("audit.descending"),()=>r()("audit.ascending")]),l(a,n)},$$slots:{default:!0}}),t(Wt),t(Tt);var Xt=s(Tt,2),Yt=e(Xt);et(Yt,{onclick:fe,children:(a,_)=>{pt();var n=tt();m(i=>d(n,i),[()=>r()("common.apply")]),l(a,n)},$$slots:{default:!0}});var Ie=s(Yt,2);et(Ie,{variant:"outline",onclick:ye,children:(a,_)=>{pt();var n=tt();m(i=>d(n,i),[()=>r()("common.clear")]),l(a,n)},$$slots:{default:!0}}),t(Xt),t($t);var It=s($t,2),Zt=e(It),te=e(Zt);ua(te,{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"});var Ce=s(te,2);{let a=gt(()=>r()("common.search"));ie(Ce,{type:"text",get placeholder(){return o(a)},class:"pl-10",get value(){return o(P)},set value(_){b(P,_,!0)}})}t(Zt),t(It);var ee=s(It,2);{var Oe=a=>{var _=Aa(),n=e(_),i=e(n,!0);t(n),t(_),m(y=>d(i,y),[()=>r()("audit.totalLogsFound",{count:L.data.totalCount||0})]),l(a,_)};O(ee,a=>{L.data&&a(Oe)})}var qe=s(ee,2);{var Qe=a=>{{let _=gt(()=>r()("common.loading"));oa(a,{get message(){return o(_)}})}},ze=a=>{var _=N(),n=T(_);{var i=p=>{var v=Da(),x=e(v,!0);t(v),m(k=>d(x,k),[()=>r()("audit.failedToLoad")]),l(p,v)},y=p=>{var v=N(),x=T(v);{var k=A=>{var h=Pa(),c=e(h);pa(c,{class:"w-12 h-12 mx-auto text-gray-400 mb-4"});var R=s(c,2),D=e(R,!0);t(R),t(h),m(W=>d(D,W),[()=>r()("audit.noLogs")]),l(A,h)},F=A=>{var h=Sa(),c=e(h),R=e(c),D=e(R),W=e(D),st=e(W),Ct=e(st,!0);t(st);var it=s(st),Be=e(it,!0);t(it);var Ot=s(it),Ee=e(Ot,!0);t(Ot);var qt=s(Ot),Ke=e(qt,!0);t(qt);var ae=s(qt),Me=e(ae,!0);t(ae),t(W),t(D);var re=s(D);Et(re,21,()=>L.data.logs,Q=>Q.id,(Q,w)=>{var K=La(),z=e(K),dt=e(z,!0);t(z);var X=s(z),nt=e(X),Qt=e(nt,!0);t(nt),t(X);var B=s(X),Y=e(B),zt=e(Y,!0);t(Y),t(B);var E=s(B),lt=e(E);{var je=M=>{var ut=tt();m(()=>d(ut,`${o(w).resourceType??""}: ${o(w).resourceId??""}`)),l(M,ut)},He=M=>{var ut=N(),Je=T(ut);{var Ve=Z=>{var ct=tt();m(()=>d(ct,o(w).resourceType)),l(Z,ct)},We=Z=>{var ct=Fa();l(Z,ct)};O(Je,Z=>{o(w).resourceType?Z(Ve):Z(We,!1)},!0)}l(M,ut)};O(lt,M=>{o(w).resourceType&&o(w).resourceId?M(je):M(He,!1)})}t(E);var oe=s(E),Ge=e(oe,!0);t(oe),t(K),m(M=>{d(dt,M),d(Qt,o(w).username||"System"),d(zt,o(w).action),d(Ge,o(w).ipAddress)},[()=>me(o(w).timestamp)]),l(Q,K)}),t(re),t(R),t(c);var Ue=s(c,2);{var Ne=Q=>{var w=Ra(),K=e(w),z=e(K),dt=e(z,!0);t(z);var X=s(z,2),nt=e(X);{let B=gt(()=>o(f)===1);et(nt,{variant:"outline",size:"sm",onclick:()=>b(f,Math.max(1,o(f)-1),!0),get disabled(){return o(B)},children:(Y,zt)=>{pt();var E=tt();m(lt=>d(E,lt),[()=>r()("common.previous")]),l(Y,E)},$$slots:{default:!0}})}var Qt=s(nt,2);{let B=gt(()=>o(f)===L.data.totalPages);et(Qt,{variant:"outline",size:"sm",onclick:()=>b(f,Math.min(L.data.totalPages,o(f)+1),!0),get disabled(){return o(B)},children:(Y,zt)=>{pt();var E=tt();m(lt=>d(E,lt),[()=>r()("common.next")]),l(Y,E)},$$slots:{default:!0}})}t(X),t(K),t(w),m(B=>d(dt,B),[()=>r()("audit.pageInfo",{current:o(f),total:L.data.totalPages,count:L.data.totalCount})]),l(Q,w)};O(Ue,Q=>{L.data.totalPages>1&&Q(Ne)})}t(h),m((Q,w,K,z,dt)=>{d(Ct,Q),d(Be,w),d(Ee,K),d(Ke,z),d(Me,dt)},[()=>r()("audit.timestamp"),()=>r()("audit.user"),()=>r()("audit.action"),()=>r()("audit.resourceType"),()=>r()("audit.ipAddress")]),l(A,h)};O(x,A=>{!L.data||L.data.logs.length===0?A(k):A(F,!1)},!0)}l(p,v)};O(n,p=>{L.error?p(i):p(y,!1)},!0)}l(a,_)};O(qe,a=>{L.isLoading?a(Qe):a(ze,!1)})}t(jt),m((a,_,n,i,y,p,v)=>{d(he,a),d(be,_),d(ke,n),d(Te,i),d(De,y),d(Fe,p),d(Re,v)},[()=>r()("audit.title"),()=>r()("audit.subtitle"),()=>r()("audit.filters"),()=>r()("audit.action"),()=>r()("audit.resourceType"),()=>r()("audit.sortBy"),()=>r()("audit.sortOrder")]),l(g,Ut),le(),q()}export{er as component};
