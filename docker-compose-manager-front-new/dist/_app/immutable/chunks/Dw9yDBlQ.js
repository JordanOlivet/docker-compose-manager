import{S as J,p as L,b as f,g as D,d as R,a as X,j as A,k as K,t as Y,l as S,m as Z,r as B,n as q,o as tt}from"./DgbRr3Sw.js";import{f as et}from"./C0aoh23D.js";import{b as g,aK as W,O as st,g as o,d as v,P as Q,k as rt,e as H,u as it}from"./BGIsFGxD.js";import{w as E,u as nt}from"./ygxaYeff.js";var at=class extends J{constructor(e,t){super(),this.options=t,this.#e=e,this.#o=null,this.#n=L(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#r=void 0;#s=void 0;#i;#a;#n;#o;#b;#d;#f;#u;#c;#h;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),V(this.#t,this.options)?this.#l():this.updateResult(),this.#R())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return F(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return F(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#g(),this.#O(),this.#t.removeObserver(this)}setOptions(e){const t=this.options,s=this.#t;if(this.options=this.#e.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof f(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),t._defaulted&&!D(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&G(this.#t,s,this.options,t)&&this.#l(),this.updateResult(),r&&(this.#t!==s||f(this.options.enabled,this.#t)!==f(t.enabled,this.#t)||R(this.options.staleTime,this.#t)!==R(t.staleTime,this.#t))&&this.#y();const n=this.#v();r&&(this.#t!==s||f(this.options.enabled,this.#t)!==f(t.enabled,this.#t)||n!==this.#h)&&this.#m(n)}getOptimisticResult(e){const t=this.#e.getQueryCache().build(this.#e,e),s=this.createResult(t,e);return ht(this,s)&&(this.#s=s,this.#a=this.options,this.#i=this.#t.state),s}getCurrentResult(){return this.#s}trackResult(e,t){return new Proxy(e,{get:(s,r)=>(this.trackProp(r),t?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#n.status==="pending"&&this.#n.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,r))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#e.defaultQueryOptions(e),s=this.#e.getQueryCache().build(this.#e,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#l({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#l(e){this.#w();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch(X)),t}#y(){this.#g();const e=R(this.options.staleTime,this.#t);if(A||this.#s.isStale||!K(e))return;const s=Y(this.#s.dataUpdatedAt,e)+1;this.#u=S.setTimeout(()=>{this.#s.isStale||this.updateResult()},s)}#v(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#m(e){this.#O(),this.#h=e,!(A||f(this.options.enabled,this.#t)===!1||!K(this.#h)||this.#h===0)&&(this.#c=S.setInterval(()=>{(this.options.refetchIntervalInBackground||Z.isFocused())&&this.#l()},this.#h))}#R(){this.#y(),this.#m(this.#v())}#g(){this.#u&&(S.clearTimeout(this.#u),this.#u=void 0)}#O(){this.#c&&(S.clearInterval(this.#c),this.#c=void 0)}createResult(e,t){const s=this.#t,r=this.options,n=this.#s,i=this.#i,a=this.#a,b=e!==s?e.state:this.#r,{state:u}=e;let h={...u},_=!1,l;if(t._optimisticResults){const d=this.hasListeners(),O=!d&&V(e,t),m=d&&G(e,s,t,r);(O||m)&&(h={...h,...et(u.data,e.options)}),t._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:k,errorUpdatedAt:x,status:y}=h;l=h.data;let j=!1;if(t.placeholderData!==void 0&&l===void 0&&y==="pending"){let d;n?.isPlaceholderData&&t.placeholderData===a?.placeholderData?(d=n.data,j=!0):d=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,d!==void 0&&(y="success",l=B(n?.data,d,t),_=!0)}if(t.select&&l!==void 0&&!j)if(n&&l===i?.data&&t.select===this.#b)l=this.#d;else try{this.#b=t.select,l=t.select(l),l=B(n?.data,l,t),this.#d=l,this.#o=null}catch(d){this.#o=d}this.#o&&(k=this.#o,l=this.#d,x=Date.now(),y="error");const P=h.fetchStatus==="fetching",T=y==="pending",I=y==="error",M=T&&P,z=l!==void 0,p={status:y,fetchStatus:h.fetchStatus,isPending:T,isSuccess:y==="success",isError:I,isInitialLoading:M,isLoading:M,data:l,dataUpdatedAt:h.dataUpdatedAt,error:k,errorUpdatedAt:x,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>b.dataUpdateCount||h.errorUpdateCount>b.errorUpdateCount,isFetching:P,isRefetching:P&&!T,isLoadingError:I&&!z,isPaused:h.fetchStatus==="paused",isPlaceholderData:_,isRefetchError:I&&z,isStale:U(e,t),refetch:this.refetch,promise:this.#n,isEnabled:f(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const d=w=>{p.status==="error"?w.reject(p.error):p.data!==void 0&&w.resolve(p.data)},O=()=>{const w=this.#n=p.promise=L();d(w)},m=this.#n;switch(m.status){case"pending":e.queryHash===s.queryHash&&d(m);break;case"fulfilled":(p.status==="error"||p.data!==m.value)&&O();break;case"rejected":(p.status!=="error"||p.error!==m.reason)&&O();break}}return p}updateResult(){const e=this.#s,t=this.createResult(this.#t,this.options);if(this.#i=this.#t.state,this.#a=this.options,this.#i.data!==void 0&&(this.#f=this.#t),D(t,e))return;this.#s=t;const s=()=>{if(!e)return!0;const{notifyOnChangeProps:r}=this.options,n=typeof r=="function"?r():r;if(n==="all"||!n&&!this.#p.size)return!0;const i=new Set(n??this.#p);return this.options.throwOnError&&i.add("error"),Object.keys(this.#s).some(a=>{const c=a;return this.#s[c]!==e[c]&&i.has(c)})};this.#S({listeners:s()})}#w(){const e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;const t=this.#t;this.#t=e,this.#r=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#R()}#S(e){q.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function ot(e,t){return f(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function V(e,t){return ot(e,t)||e.state.data!==void 0&&F(e,t,t.refetchOnMount)}function F(e,t,s){if(f(t.enabled,e)!==!1&&R(t.staleTime,e)!=="static"){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&U(e,t)}return!1}function G(e,t,s,r){return(e!==t||f(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&U(e,s)}function U(e,t){return f(t.enabled,e)!==!1&&e.isStaleByTime(R(t.staleTime,e))}function ht(e,t){return!D(e.getCurrentResult(),t)}function ut(){return tt()}var ct=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],lt=["difference","intersection","symmetricDifference","union"],N=!1;class C extends Set{#e=new Map;#t=g(0);#r=g(0);#s=W||-1;constructor(t){if(super(),t){for(var s of t)super.add(s);this.#r.v=super.size}N||this.#a()}#i(t){return W===this.#s?g(t):st(t)}#a(){N=!0;var t=C.prototype,s=Set.prototype;for(const r of ct)t[r]=function(...n){return o(this.#t),s[r].apply(this,n)};for(const r of lt)t[r]=function(...n){o(this.#t);var i=s[r].apply(this,n);return new C(i)}}has(t){var s=super.has(t),r=this.#e,n=r.get(t);if(n===void 0){if(!s)return o(this.#t),!1;n=this.#i(!0),r.set(t,n)}return o(n),s}add(t){return super.has(t)||(super.add(t),v(this.#r,super.size),Q(this.#t)),this}delete(t){var s=super.delete(t),r=this.#e,n=r.get(t);return n!==void 0&&(r.delete(t),v(n,!1)),s&&(v(this.#r,super.size),Q(this.#t)),s}clear(){if(super.size!==0){super.clear();var t=this.#e;for(var s of t.values())v(s,!1);t.clear(),v(this.#r,0),Q(this.#t)}}keys(){return this.values()}values(){return o(this.#t),super.values()}entries(){return o(this.#t),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return o(this.#r)}}function dt(e){const t=Array.isArray(e)?[]:{},s=new C,r=new Proxy(t,{set(i,a,c,b){if(s.delete(a),a in i)return Reflect.set(i,a,c,b);let u=g(c);return Object.defineProperty(i,a,{configurable:!0,enumerable:!0,get:()=>o(u)&&pt(o(u))?o(u)():o(u),set:h=>{v(u,h)}}),!0},has:(i,a)=>s.has(a)?!1:a in i,ownKeys(i){return Reflect.ownKeys(i).filter(a=>!s.has(a))},getOwnPropertyDescriptor(i,a){if(!s.has(a))return Reflect.getOwnPropertyDescriptor(i,a)},deleteProperty(i,a){return a in i?(i[a]=void 0,s.add(a),Array.isArray(i)&&i.length--,!0):!1}});function n(i){const a=Object.keys(r),c=Object.keys(i),b=a.filter(u=>!c.includes(u));for(const u of b)delete r[u];for(const u of c)r[u]=ft(()=>i[u])}return n(e),[r,n]}const $=Symbol("LazyValue");function ft(e){return e[$]=!0,e}function pt(e){return!!e[$]}function bt(e,t,s){const r=H(()=>nt()),n=ut(),i=H(()=>{const h=o(r).defaultQueryOptions(e());return h._optimisticResults=n.current?"isRestoring":"optimistic",h});let a=g(rt(new t(o(r),o(i))));E(()=>o(r),"pre",()=>{v(a,new t(o(r),o(i)),!0)});function c(){const h=o(a).getOptimisticResult(o(i));return o(i).notifyOnChangeProps?h:o(a).trackResult(h)}const[b,u]=dt(c());return it(()=>{const h=n.current?()=>{}:o(a).subscribe(()=>u(c()));return o(a).updateResult(),h}),E(()=>o(i),"pre",()=>{o(a).setOptions(o(i))}),E(()=>[o(i),o(a)],"pre",()=>{u(c())}),b}function Ot(e,t){return bt(e,at)}export{Ot as c};
