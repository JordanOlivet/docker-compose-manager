import{c as v,a as y}from"./AQshOrwM.js";import"./CVCFcqur.js";import{f as U}from"./BGIsFGxD.js";import{I as $,s as D}from"./DNE0aubT.js";import{l as j,s as I}from"./BBZnTf8d.js";import{H as L,L as R,a as r}from"./B8pBSBZ4.js";function B(e,i){const n=j(i,["children","$$slots","$$events","$$legacy"]);const t=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}]];$(e,I({name:"rotate-cw"},()=>n,{get iconNode(){return t},children:(s,H)=>{var m=v(),T=U(m);D(T,i,"default",{}),y(s,m)},$$slots:{default:!0}}))}let c=null,o=null,g=!1,a=!1;const f=new Set,l=new Set,C=new Set,d=new Set,u=new Set,w=new Set,h=new Set,p=new Set,S=new Set,E=()=>"";function W(){if(c)return;const e=E(),i=e?`${e}/hubs/operations`:"/hubs/operations";c=new L().withUrl(i,{accessTokenFactory:()=>localStorage.getItem("accessToken")||""}).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).configureLogging(R.Warning).build(),c.on("OperationUpdate",n=>{f.forEach(t=>t(n))}),c.on("ContainerStateChanged",n=>{l.forEach(t=>t(n))}),c.on("ComposeProjectStateChanged",n=>{C.forEach(t=>t(n))}),c.onclose(n=>{u.forEach(t=>t(n??void 0))}),c.onreconnecting(n=>{w.forEach(t=>t(n??void 0))}),c.onreconnected(()=>{d.forEach(n=>n())})}function q(e={}){return W(),e.onOperationUpdate&&f.add(e.onOperationUpdate),e.onContainerStateChanged&&l.add(e.onContainerStateChanged),e.onComposeProjectStateChanged&&C.add(e.onComposeProjectStateChanged),e.onConnected&&d.add(e.onConnected),e.onDisconnected&&u.add(e.onDisconnected),e.onReconnecting&&w.add(e.onReconnecting),()=>{e.onOperationUpdate&&f.delete(e.onOperationUpdate),e.onContainerStateChanged&&l.delete(e.onContainerStateChanged),e.onComposeProjectStateChanged&&C.delete(e.onComposeProjectStateChanged),e.onConnected&&d.delete(e.onConnected),e.onDisconnected&&u.delete(e.onDisconnected),e.onReconnecting&&w.delete(e.onReconnecting)}}async function _(){if(!(!c||g)){if(c.state===r.Connected){d.forEach(e=>e());return}g=!0;try{await c.start(),console.log("SignalR connected"),d.forEach(e=>e())}catch(e){console.error("SignalR connection error:",e),setTimeout(_,5e3)}finally{g=!1}}}async function x(){if(o)return;const e=E(),i=e?`${e}/hubs/logs`:"/hubs/logs";o=new L().withUrl(i,{accessTokenFactory:()=>localStorage.getItem("accessToken")||""}).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).configureLogging(R.Warning).build(),o.on("ReceiveLogs",n=>{h.forEach(t=>t(n))}),o.on("LogError",n=>{p.forEach(t=>t(n))}),o.on("StreamComplete",()=>{S.forEach(n=>n())}),o.onclose(n=>{console.error("Logs SignalR connection closed:",n),a=!1}),o.onreconnecting(n=>{console.warn("Logs SignalR connection lost. Reconnecting...",n)}),o.onreconnected(n=>{console.log("Logs SignalR reconnected. Connection ID:",n)})}async function z(){if(!(o&&o.state===r.Connected)){if(a){const i=Date.now();for(;a&&Date.now()-i<5e3;)await new Promise(n=>setTimeout(n,100));if(o&&o.state===r.Connected)return}a=!0;try{if(o||await x(),!o)throw new Error("Failed to initialize logs connection");await o.start(),console.log("Logs SignalR connected successfully")}catch(e){throw console.error("Logs SignalR connection error:",e),e}finally{a=!1}}}async function G(e,i){if(!o)throw new Error("Logs SignalR connection not initialized. Call connectToLogsHub() first.");const n=5e3,t=Date.now();for(;o.state!==r.Connected;){if(Date.now()-t>n)throw new Error("Timeout waiting for logs connection to be established");await new Promise(s=>setTimeout(s,100))}await o.invoke("StreamComposeLogs",e,i)}async function J(e,i=100){if(await z(),!o)throw new Error("Logs SignalR connection unavailable after connect attempt");if(!o.connectionId){const t=Date.now();for(;o&&!o.connectionId;){if(Date.now()-t>3e3)throw new Error("Timeout waiting for logs connection to become connected");await new Promise(s=>setTimeout(s,100))}}await o.invoke("StreamContainerLogs",e,i)}async function K(){o&&o.state===r.Connected&&await o.invoke("StopStream")}function Q(e){h.add(e)}function V(e){h.delete(e)}function X(e){p.add(e)}function Y(e){p.delete(e)}function Z(e){S.add(e)}function k(e){S.delete(e)}function P(){return o?.state===r.Connected}export{B as R,Y as a,k as b,q as c,z as d,Q as e,X as f,Z as g,J as h,P as i,G as j,K as k,V as o,_ as s};
